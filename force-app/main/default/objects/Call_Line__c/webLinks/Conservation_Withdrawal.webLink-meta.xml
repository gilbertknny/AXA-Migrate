<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Conservation_Withdrawal</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Conservation &amp; Withdrawal</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/53.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/53.0/apex.js&quot;)}
{!REQUIRESCRIPT(&quot;/support/console/26.0/integration.js&quot;)}

var url = &quot;/apex/Conservation_Withdrawal?id={!Call_Line__c.Id}&quot;;

var result = sforce.connection.query(&quot;SELECT Id, Name, Call_List__c, Call_List__r.Activity__c, Call_List__r.Case_Type_Config__c, Nilai_Conservation__c, Nilai_Withdrawal__c, Selisih__c, Offering_Retain__c, Call_Status_Config__c, Reason_Status_Config__c FROM Call_Line__c WHERE Id = &apos;{!Call_Line__c.Id }&apos; limit 1&quot;);

records = result.getArray(&quot;records&quot;);

var callStatus = records[0].Call_Status_Config__c;
var reasonStatus = records[0].Reason_Status_Config__c;
var activity = records[0].Call_List__r.Activity__c;
var caseType = records[0].Call_List__r.Case_Type_Config__c;

if(activity == &apos;Conservation&apos; &amp;&amp; (caseType == &apos;Retain Redemption&apos; || caseType == &apos;Retain Withdrawal&apos;)){

//callStatus == &apos;Contacted&apos; &amp;&amp; reasonStatus.indexOf(&quot;Agree&quot;) !== -1){

if (sforce.console.isInConsole()) {
sforce.console.getEnclosingTabId(function(enclosingResult){
sforce.console.getEnclosingPrimaryTabId(function(){
sforce.console.openPrimaryTab(null, url, true, &apos;Conservation &amp; Withdrawal&apos;, null);
});
});

} else {
window.location.href = url;
}

} else {

alert(&quot;Maaf, tombol ini hanya untuk Case Type = \&apos;Retain Redemption\&apos; atau Case Type = \&apos;Retain Withdrawal\&apos; &quot;);

}</url>
</WebLink>
