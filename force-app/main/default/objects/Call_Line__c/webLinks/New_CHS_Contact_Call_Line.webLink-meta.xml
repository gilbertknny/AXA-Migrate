<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>New_CHS_Contact_Call_Line</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>New CHS</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/53.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/53.0/apex.js&quot;)}
{!REQUIRESCRIPT(&quot;/support/console/26.0/integration.js&quot;)}
 

var caseList = sforce.connection.query(&quot;SELECT Id,Record_Type_Keeper__c, Account.Id, Entity__c FROM Contact WHERE id =&apos;{!Call_Line__c.ContactId__c}&apos;&quot;);
var records = caseList.getArray(&quot;records&quot;); 
var Record_Type_Keeper__c,AccountId,entity;  
if (records.length &gt; 0) { 
for (var i=0; i&lt; records.length; i++) {
    Record_Type_Keeper__c = records[i].Record_Type_Keeper__c;
    AccountId = records[i].Account.Id;
    entity = records[i].Entity__c ;
}
} 
 
var urlCallNote = &apos;&apos;; 

if (entity  == &apos;AMFS&apos;) {

urlCHS = &quot;/apex/CaseComplaintLayoutContact?retURL=/{!Call_Line__c.Id}&amp;def_contact_id={!Call_Line__c.ContactId__c }&amp;call_line={!Call_Line__c.Id}&amp;00N9000000CD53R=0&amp;cas5=Complaint&amp;ent=Case&amp;cas11=contact&amp;entity={!  Call_Line__c.Entity__c  }&amp;def_account_id=&quot;+AccountId +&quot;&amp;RecordType=&quot;+Record_Type_Keeper__c;

} else {
urlCHS = &quot;/apex/CaseComplaintLayoutContact?retURL=/{!Call_Line__c.ContactId__c }&amp;def_contact_id={!Call_Line__c.ContactId__c }&amp;00N9000000CD53R=0&amp;cas5=Complaint&amp;ent=Case&amp;cas11=contact&amp;entity={!  Call_Line__c.Entity__c  }&amp;call_line={!Call_Line__c.Id}&amp;def_account_id=&quot;+AccountId +&quot;&amp;callLineId={!Call_Line__c.Id}&amp;RecordType=&quot;+Record_Type_Keeper__c;
}


if (sforce.console.isInConsole()) {
    sforce.console.getEnclosingTabId(function(enclosingResult){
    sforce.console.getEnclosingPrimaryTabId(function(){
        sforce.console.openPrimaryTab(null, urlCHS, true, &apos;Create New CHS&apos;, null);
    });
});

}else {
    window.location.href = urlCHS;
}</url>
</WebLink>
